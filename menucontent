#!/bin/bash

stty -echo

while true; do
  clear
  [ -f /etc/issue ] && cat /etc/issue && echo

  echo "======================================"
  echo "   MENU DE ACESSO AO SERVIDOR"
  echo "======================================"
  echo "1) Status do servidor"
  echo "2) Uso de processamento"
  echo "3) Reiniciar servidor"
  echo "4) Desligar servidor"
  echo "======================================"
  echo "5) Atualizar servidor"
  echo "6) Reiniciar o Túnel"
  echo "7) Reiniciar Serviço Docker"
  echo "======================================"

  stty echo
  read -p "Escolha uma opção: " opcao
  stty -echo

  case "$opcao" in
    1)
      clear
      uptime
      free -h
      df -h -x overlay -x tmpfs
      read -p "ENTER para voltar..."
      ;;
    2)
      clear
      htop
      ;;
    3)
      echo "Reiniciando, aguarde..."
      systemctl reboot
      exit 0
      ;;
    4)
      echo "Desligando, aguarde..."
      systemctl poweroff
      exit 0
      ;;
    5)
      apt update && apt upgrade -y
      read -p "Sistema atualizado, precione ENTER para voltar..."
      ;;
    6)
      if systemctl list-unit-files | grep -q '^cloudflared\.service'; then
        systemctl restart cloudflared
        read -p "Tunel reiniciado, pressione ENTER para voltar..."
      else
        echo "❌ Tunel não existe, ainda, neste sistema."
        read -p "Pressione ENTER para voltar..."
      fi
      ;;
    7)
      if systemctl list-unit-files | grep -q '^docker\.service'; then
        systemctl restart docker
        read -p "Serviço Docker reiniciado, pressione ENTER para voltar..."
      else
        echo "❌ Serviço Docker não existe neste sistema."
        read -p "Pressione ENTER para voltar..."
      fi
      ;;
    777)
      stty echo
      exec /sbin/agetty --noclear tty1 linux
      ;;
    *) 
      read -p "Opção inválida tente novamente..."
      ;;
  esac
done
